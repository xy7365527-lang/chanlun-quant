name: Codex Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
  pull_request_review_comment:
    types: [created]
  issue_comment:
    types: [created]

jobs:
  codex-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Codex Code Review
        uses: codex-team/codex-reviewer@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          # 审查的文件类型
          include-patterns: |
            **/*.py
            **/*.js
            **/*.ts
            **/*.jsx
            **/*.tsx
          # 排除的文件和目录
          exclude-patterns: |
            **/__pycache__/**
            **/node_modules/**
            **/dist/**
            **/build/**
            **/*.pyc
            **/package-lock.json
            **/uv.lock
          # 审查语言设置为中文
          language: zh-CN
          # 审查级别: strict, normal, lenient
          review-level: normal
          # 自动回复 👍 当代码质量良好时
          auto-approve: true

